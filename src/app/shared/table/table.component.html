<div class="tables-container">
  <div class="table-header">
    <div class="header-left">
      <button
        *ngIf="tableData.showAdd"
        class="add-btn"
        type="button"
        (click)="onAddClick()"
        aria-label="Add">
        <mat-icon>+</mat-icon>
        <span class="add-text">{{ tableData.addLabel ?? 'Add' }}</span>
      </button>

      <h3 class="table-title">{{ tableData.title ?? '' }}</h3>
    </div>

    <!-- NEW: right side toolbar in header row -->
    <div class="header-right" *ngIf="!tableData.loading && !tableData.error">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search</mat-label>
        <input
          matInput
          type="text"
          placeholder="Search by any field..."
          [(ngModel)]="searchText"
          (ngModelChange)="applySearch()" />
      </mat-form-field>
    </div>
  </div>

  <div *ngIf="tableData.loading" class="loading">Loading...</div>
  <div *ngIf="tableData.error" class="error">{{ tableData.error }}</div>

  <table
    class="data-table"
    mat-table
    [dataSource]="dataSource"
    matSort
    *ngIf="!tableData.loading && !tableData.error">

    <ng-container *ngFor="let col of tableData.columns" [matColumnDef]="col.field.toString()">
      <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="col.sortable === false">
        {{ col.header }}
      </th>

      <td mat-cell *matCellDef="let row">
        <button
          *ngIf="col.clickable; else normalCell"
          type="button"
          class="cell-link"
          (click)="onCellClick(row, col)">
          {{ getCellValue(row, col) }}
        </button>

        <ng-template #normalCell>
          {{ getCellValue(row, col) }}
        </ng-template>
      </td>
    </ng-container>

    <ng-container *ngIf="tableData.showActions" matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let row" class="actions">
        <button type="button" class="btn btn-danger" (click)="remove.emit(row)">Delete</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator
    *ngIf="tableData.showPagination !== false && !tableData.loading && !tableData.error && dataSource.data.length > 0"
    [pageSize]="tableData.pageSize ?? 5"
    [pageSizeOptions]="tableData.pageSizeOptions ?? [5, 10, 20]"
    (page)="onPaginatorChange($event)"
    showFirstLastButtons>
  </mat-paginator>

  <div
    class="no-data"
    *ngIf="!tableData.loading && !tableData.error && dataSource.data.length === 0">
    No data found.
  </div>
</div>
